#!/usr/bin/env BQN

âŸ¨Digits, Part, ToNat, Group, _while_âŸ© â† â€¢Import "idioms.bqn"

input â† (â‹ˆâŸ¨320,159âŸ©â€¿âŸ¨700,159âŸ©) âˆ¾ (2 Group (ToNatÂ¨ DigitsâŠ¸Part))Â¨ â€¢FLines "files/14.txt"

A â† (1+(+Â´|))âŠ¸(â†•âˆ˜âŠ£Ã—(âŠ£/â‹ˆâˆ˜(Ã—âˆ˜-)âˆ˜âŠ¢))

walls â† (âŠ¢-â‰ /(â‹ˆâŒŠÂ´)) âŸ¨500â€¿0âŸ© âˆ¾ â· âˆ¾ (âˆ¾âˆ˜((âŠ¢+â‰ âˆ˜âŠ¢/â‹ˆâˆ˜âŠ£)Â´Â¨)âˆ˜((âŠâ‹ˆÂ¨(<âˆ˜A-Â´))Ë˜) 2âŠ¸â†•)Â¨ input
waterfall â† { ğ•©âŠ¸(Â¬ Â¯1 âŒ½ âˆŠËœ)Ë˜ (â‰âˆ˜â†•3+âŒˆÂ´) ğ•© } walls
origin â† 1â€¿0 + âŠ‘walls

Next â† âŠ‘ (â‹ˆ 0â€¿1âŠ¸âŠ‘) âˆ¾Ëœ âŠ£ ((/âŠ¢âŠ‘â‰âˆ˜âŠ£)âŠâŠ¢) 1âŠ¸âŠ
Path â† (â‹ˆ âŠ£ Next { (1â€¿0 -Ëœ ğ•©)âŠ¸+âŒœ (âŒ½ âŒ¾ (2âŠ¸â†‘1âŠ¸âŠ) â‰ â†•3â€¿2) }âˆ˜âŠ‘âˆ˜âŠ¢) âˆ¾ âŠ¢
Recurse â† { ğ•¨âŠ¸Path _while_ (âŠ‘ â‰¢ âŠ‘âˆ˜(ğ•¨âŠ¸Path)) ğ•© }
Update â† 1âŠ¸â†“ â‹ˆËœ âŠ£ { Â¬ âŒ¾ (ğ•©âŠ¸âŠ‘) ğ•¨ } âŒ½âˆ˜âŠ‘âˆ˜âŠ¢
Sand â† (âŠ£ Update Recurse)Â´

â€¢Show âŠ‘ ((Sand 1âŠ¸âŠ‘) â‹ˆËœ 1+âŠ‘) _while_ (1=(Ã—Â´158âŠ(âŠ‘1âŠ‘âŠ¢))) Â¯1 â‹ˆ waterfall â‹ˆâ‹ˆ origin # part 1
â€¢Show âŠ‘ ((Sand 1âŠ¸âŠ‘) â‹ˆËœ 1+âŠ‘) _while_ (Â¬(âŒ½origin)âŠ‘(âŠ‘1âŠ‘âŠ¢)) 0 â‹ˆ waterfall â‹ˆâ‹ˆ origin # part 2
