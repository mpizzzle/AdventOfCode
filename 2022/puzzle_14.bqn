#!/usr/bin/env BQN

âŸ¨Digits, Part, ToNat, GroupâŸ© â† â€¢Import "idioms.bqn"

_While_ â† {ğ”½âŸğ”¾âˆ˜ğ”½_ğ•£_ğ”¾âˆ˜ğ”½âŸğ”¾ğ•©}

Parse â† (2 Group (ToNatÂ¨ DigitsâŠ¸Part))Â¨

test â† Parse "498,4 -> 498,6 -> 496,6"â€¿"503,4 -> 502,4 -> 502,9 -> 494,9"
input â† Parse â€¢FLines "files/14.txt"

A â† (1+(+Â´|))âŠ¸(â†•âˆ˜âŠ£Ã—(âŠ£/â‹ˆâˆ˜(Ã—âˆ˜-)âˆ˜âŠ¢))

walls â† âŸ¨500â€¿0âŸ© âˆ¾ â· âˆ¾ {âˆ¾{ğ•¨âŠ¸+Â¨ğ•©}Â´Â¨ (âŠ â‹ˆÂ¨ <âˆ˜(A-Â´))Ë˜ 2â†•ğ•© }Â¨ input
shifted â† (âŠ¢-â‰ /(â‹ˆâŒŠÂ´)) walls
coords â† (â‰âˆ˜â†•3+âŒˆÂ´) shifted
windows â† ((âŒ½ âŒ¾ (2âŠ¸â†‘1âŠ¸âŠ))â‰2 2â€¿3âŠ¸â†•) coords
o â† (âŠ‘âŠ‘shifted) âŠ 0 âŠ windows
waterfall â† (Â¬ Â¯1 âŒ½ shifted âˆŠËœ âŠ¢)Ë˜ coords

Next â† { âŠ‘ (â‹ˆ 1 âŠ‘ 0 âŠ ğ•¨) âˆ¾Ëœ (1 âŠ ğ•¨) âŠËœ / (1 âŠ ğ•¨) âŠ‘ â‰ ğ•© }
NextWindow â† { (1-ËœâŠ‘ ğ•¨) âŠ (âŠ‘âˆ˜âŒ½ ğ•¨) âŠ ğ•© }
Step â† windows NextWindowËœ NextËœ

Sand â† { 0 âŒ¾ ((âŒ½ 0â€¿1 âŠ‘ ğ•©âŠ¸Step _While_ (ğ•©âŠ¸(âŠ¢ â‰¢ Step)) o)âŠ¸âŠ‘) ğ•© }

SandâŸ719 waterfall
