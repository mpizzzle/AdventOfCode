#!/usr/bin/env BQN

input â† â€¢FLines "files/19.txt"

Split â† âŠ¢-Ëœ+`Ã—Â¬
Format â† 1â€¿0â€¿1 / ' ' (Splitâˆ˜=âŠ”âŠ¢) âŠ¢
Partition â† SplitâŠ¸âŠ”
ExpandShape â† { (â‰ ğ•©) /â‹ˆ ğ•¨ }
ExpandIndices â† { ğ•© ExpandShapeËœ â†•â‰ ğ•¨ }
GetIndices â† { ğ•© + ğ•¨ ExpandIndices ğ•© }
Indices â† { ğ•¨ GetIndices ğ•¨ /âˆ˜â· ğ•© }
GetMasks â† { (ğ•¨ ExpandIndices ğ•©) âˆŠÂ¨ ğ•© }
RotateColumns â† âˆ¾ âŒ½ âŒ¾ (2âŠ¸â†‘)
GetPartitions â† GetMasks PartitionÂ¨ ExpandShape
DoThing â† âŠ£ IndicesËœ 0 âŠ‘ âŠ¢
EnlistReplacement â† â‹ˆ 1âŠ¸âŠ‘
GetElectrons â† /âˆ˜((âˆ¨Â´âˆ˜âˆ¾)Â¨'e'âŠ¸=)âŠâŠ¢

GetMolecules â† {
  idx â† ğ•¨ DoThing ğ•©
  replace â† idx ExpandShapeËœ EnlistReplacement ğ•©
  partitions â† ğ•¨ GetPartitions idx
  stripped â† âˆ¾Â¨ partitions
  joined â† replace âˆ¾Â¨ stripped
  RotateColumns Â¨ joined
}

replacements â† âŒ½âˆ˜Format Â¨ Â¯2â†“input
byLength â† { ğ•© âŠËœ â’ â‰ âˆ˜âŠ‘Â¨ğ•© } replacements
molecule â† Â¯1 âŠ‘ input

â‰  âŠ‘ molecule GetMolecules 1 âŠ‘ byLength

testMolecule â† "HOHOHO"

testReplacements â† âŸ¨
  "e => H",
  "e => O",
  "H => HO",
  "H => OH",
  "O => HH"
âŸ©

sorted â† (â’â‰ âˆ˜âŠ‘Â¨)âŠ¸âŠ âŒ½âˆ˜Format Â¨ testReplacements


/ testMolecule â·Ëœ âŠ‘ 0 âŠ‘ sorted

#firstGen â† âŠ‘âˆ˜âŒ½Â¨ GetElectrons replacements
#secondGen â† â·âˆ¾ replacements âŠ¸ { âˆ¾ ğ•© âŠ¸ GetMolecules Â¨ ğ•¨ } Â¨ firstGen
#thirdGen â† â·âˆ¾ replacements âŠ¸ { âˆ¾ ğ•© âŠ¸ GetMolecules Â¨ ğ•¨ } Â¨ secondGen
#
#tr â† Format Â¨ testReplacements
#testFirstGen â† âŠ‘âˆ˜âŒ½Â¨ GetElectrons tr
#f â† âŠ‘ testFirstGen

#x â† ("HH" ExpandShape â‹ˆâ‹ˆ0)
#w â† "H" GetMasks â‹ˆâ‹ˆ0
#w (1â‰ â‰ âˆ˜âˆ¾) â—¶ âŠ¢â€¿Partition x
#w PartitionÂ¨ x
#f GetMolecules 2 âŠ‘ tr
#â·âˆ¾ tr  { âˆ¾ ğ•© âŠ¸ GetMolecules Â¨ ğ•¨ } âŠ‘ testFirstGen

â€¢Show â‰ â·âˆ¾ molecule âŠ¸ GetMolecules Â¨ replacements  # part 1
