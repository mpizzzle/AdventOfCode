#! /usr/bin/apl --script

input← ⎕FIO[49] 'files/3.txt'

f← { +/(2 * ⍺) × ⍵ }
a← {⍵ = '1'} ¨ input
y f x × (y← ⌽ (⍳⍴ x) - 1) f ~x← ⊃ ((≢ input) ÷ 2) < +/a ⍝ part 1

m← { ⍺ ({ (⊃ ⍺ ⌷ (⊃ ((≢ ⍵ ) ÷ 2) > +/⍵ ) { (~ ⍣ ⍺) ⍵ } ¨ (⊂ ⍤1)⍉ ⊃ ⊃ ⍵ ) / ⍵  } ⍣ ((⍴ ⍵ ) > 1)) ⍵ }
n← { ⍺ ({ (⊃ ⍺ ⌷ (⊃ ((≢ ⍵ ) ÷ 2) ≤ +/⍵ ) { (~ ⍣ ⍺) ⍵ } ¨ (⊂ ⍤1)⍉ ⊃ ⊃ ⍵ ) / ⍵  } ⍣ ((⍴ ⍵ ) > 1)) ⍵ }

s← ⍴ ↑ a
r← (⌽ (⍳s) - 1)
o← r f s ⍴ ⊃ ⊃ m/(r + 1),(⊂ a)
c← r f s ⍴ ⊃ ⊃ n/(r + 1),(⊂ a)
o × c ⍝ part 2

)OFF
