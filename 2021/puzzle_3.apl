#! /usr/bin/apl --script

input← ⎕FIO[49] 'files/3.txt'

f← { +/(2 * ⍺) × ⍵ }
a← {⍵ = '1'} ¨ input
y f x × (y← ⌽ (⍳⍴ x) - 1) f ~x← ⊃ ((≢ input) ÷ 2) < +/a ⍝ part 1

m← { ⍺ ({ (⊃ ⍺ ⌷ (⊃ ((≢ ⍵ ) ÷ 2) > +/⍵ ) { (~ ⍣ ⍺) ⍵ } ¨ (⊂ ⍤1)⍉ ⊃ ⊃ ⍵ ) / ⍵  } ⍣ ((⍴ ⍵ ) > 1)) ⍵ }
n← { ⍺ ({ (⊃ ⍺ ⌷ (⊃ ((≢ ⍵ ) ÷ 2) ≤ +/⍵ ) { (~ ⍣ ⍺) ⍵ } ¨ (⊂ ⍤1)⍉ ⊃ ⊃ ⍵ ) / ⍵  } ⍣ ((⍴ ⍵ ) > 1)) ⍵ }

(r f s ⍴ ⊃ ⊃ m/(r + 1),(⊂ a)) × (r f s ⍴ ⊃ ⊃ n/(1 + r← (⌽ (⍳s← ⍴ ↑ a) - 1)),(⊂ a)) ⍝ part 2

)OFF
