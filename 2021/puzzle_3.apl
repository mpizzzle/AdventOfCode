#! /usr/bin/apl --script

input← ⎕FIO[49] 'files/3.txt'

a← {⍵ = '1'} ¨ input
2⊥ x × 2⊥ ~x← ⊃ ((≢ input) ÷ 2) < +/a ⍝ part 1

o← { ⍺ { (⊃ ⍺ ⌷ (⊃ ((≢ ⍵ ) ÷ 2) > +/⍵ ) { (~ ⍣ ⍺) ⍵ } ¨ (⊂ ⍤1)⍉ ⊃ ⊃ ⍵ ) / ⍵  } ⍣ ((⍴ ⍵ ) > 1) ⍵ }
c← { ⍺ { (⊃ ⍺ ⌷ (⊃ ((≢ ⍵ ) ÷ 2) ≤ +/⍵ ) { (~ ⍣ ⍺) ⍵ } ¨ (⊂ ⍤1)⍉ ⊃ ⊃ ⍵ ) / ⍵  } ⍣ ((⍴ ⍵ ) > 1) ⍵ }

(2⊥ s ⍴ ∊ o/(r + 1),⊂ a) × (2⊥ s ⍴ ∊ c/(1 + r← (⌽ (⍳s← ⍴ ↑ a) - 1)),⊂ a) ⍝ part 2

)OFF
